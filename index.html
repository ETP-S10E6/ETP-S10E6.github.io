<html>
  <head>
    <title>ETP</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<style>a-scene {
  height: 100%;
  width: 100%;
}</style>

  </head>
  <body>
    <script type="text/javascript">
      AFRAME.registerComponent("zoom-component", {
        schema: {},
        init: function () {
          document.addEventListener("wheel", this.camzoom.bind(this));
        },
        camzoom: function (event) {
          // small increments for smoother zooming
          const delta = event.wheelDelta / 120 / 10;
          var zoom = this.el.getAttribute("camera").zoom;
          var finalZoom = zoom + delta;
          // limiting the zoom
          if (finalZoom < 3) finalZoom = 3;
          if (finalZoom > 6) finalZoom = 6;
          this.el.setAttribute("camera", "zoom", finalZoom);
        },
      });
    </script>

    <script type="text/javascript">
      AFRAME.registerComponent("button_enabled", {
        schema: {
          number: { type: "int", default: 1 },
          enabled: { type: "boolean", default: "false" },
          go: { type: "boolean", default: "true" },
        },
        init: function () {
          document
            .getElementById("button1")
            .addEventListener("click", this.b1.bind(this));
          document
            .getElementById("button2")
            .addEventListener("click", this.b2.bind(this));
          document
            .getElementById("button3")
            .addEventListener("click", this.b3.bind(this));
          document
            .getElementById("button4")
            .addEventListener("click", this.b4.bind(this));
          document
            .getElementById("buttons")
            .addEventListener("mousedown", this.bd.bind(this));
        },
        b1: function () {
          this.data.enabled = this.data.number == 1;
        },
        b2: function () {
          this.data.enabled = this.data.number == 2;
        },
        b3: function () {
          this.data.enabled = this.data.number == 3;
        },
        b4: function () {
          this.data.enabled = this.data.number == 4;
        },
        bd: function () {
          this.data.go = false;
        },
      });
    </script>

    <script type="text/javascript">
      AFRAME.registerComponent("drag-rotate-component", {
        schema: { speed: { default: 1 } },
        init: function () {
          this.ifMouseDown = false;
          this.x_cord = 0;
          this.y_cord = 0;
          this.vectx = new THREE.Vector3(1, 0, 0);
          this.vecty = new THREE.Vector3(0, 1, 0);
          this.vectz = new THREE.Vector3(0, 0, 1);

          document.addEventListener(
            "mousedown",
            this.OnDocumentMouseDown.bind(this)
          );
          document.addEventListener(
            "mouseup",
            this.OnDocumentMouseUp.bind(this)
          );
          document.addEventListener(
            "mousemove",
            this.OnDocumentMouseMove.bind(this)
          );
        },
        OnDocumentMouseDown: function (event) {
          if(this.el.components.button_enabled.data.go) {
            this.ifMouseDown = true;
            this.x_cord = event.clientX;
            this.y_cord = event.clientY;
          }
          else{
            this.el.components.button_enabled.data.go = true;
          }
        },
        OnDocumentMouseUp: function () {
          this.ifMouseDown = false;
        },
        OnDocumentMouseMove: function (event) {
          if (this.el.components.button_enabled.data.enabled) {
            if (this.ifMouseDown) {
              var temp_x = event.clientX - this.x_cord;
              var temp_y = event.clientY - this.y_cord;

              this.el.object3D.rotateOnWorldAxis(
                this.vecty,
                (temp_x * this.data.speed) / 100
              );
              this.el.object3D.rotateOnWorldAxis(
                this.vectx,
                (temp_y * this.data.speed) / 100
              );

              this.x_cord = event.clientX;
              this.y_cord = event.clientY;
            }
          }
        },
      });
    </script>

    <script type="text/javascript">
      AFRAME.registerComponent("wasd-move-component", {
        schema: { speed: { default: 0.015 } },
        init: function () {
          this.up = false;
          this.down = false;
          this.left = false;
          this.right = false;
          document.addEventListener("keydown", this.press.bind(this));
          document.addEventListener("keyup", this.release.bind(this));
        },
        press: function (event) {
          if (this.el.components.button_enabled.data.enabled) {
            if (event.keyCode === 38 /* up */ || event.keyCode === 87 /* w */) {
              this.up = true;
            }
            if (
              event.keyCode === 39 /* right */ ||
              event.keyCode === 68 /* d */
            ) {
              this.right = true;
            }
            if (
              event.keyCode === 40 /* down */ ||
              event.keyCode === 83 /* s */
            ) {
              this.down = true;
            }
            if (
              event.keyCode === 37 /* left */ ||
              event.keyCode === 65 /* a */
            ) {
              this.left = true;
            }
          }
          else{
            this.up = this.right = this.down = this.left = false;
          }
        },
        release: function (event) {
          if (event.keyCode === 38 /* up */ || event.keyCode === 87 /* w */) {
            this.up = false;
          }
          if (
            event.keyCode === 39 /* right */ ||
            event.keyCode === 68 /* d */
          ) {
            this.right = false;
          }
          if (event.keyCode === 40 /* down */ || event.keyCode === 83 /* s */) {
            this.down = false;
          }
          if (event.keyCode === 37 /* left */ || event.keyCode === 65 /* a */) {
            this.left = false;
          }
        },
        tick: function () {
          var x = this.el.object3D.position.x;
          var y = this.el.object3D.position.y;
          var z = this.el.object3D.position.z;
          if (this.up) {
            y = y + this.data.speed;
          }
          if (this.right) {
            x = x + this.data.speed;
          }
          if (this.down) {
            y = y - this.data.speed;
          }
          if (this.left) {
            x = x - this.data.speed;
          }
          if (this.up || this.right || this.left || this.down) {
            this.el.object3D.position.set(x, y, z);
          }
        },
      });
    </script>


<div style="
        position: fixed;
        top: 10px;
        left: 50%;
        text-align: center;
        margin-left: -250px;
        width:500px;height:50px;
        z-index: 1;
      " class="btn-group" role="group" id ="buttons">
  <input type="radio" class="btn-check" name="btnradio" id="button1" autocomplete="off" checked>
  <label class="btn btn-outline-light" for="button1"> Spine</label>

  <input type="radio" class="btn-check" name="btnradio" id="button2" autocomplete="off">
  <label class="btn btn-outline-light" for="button2">Heart-1</label>

  <input type="radio" class="btn-check" name="btnradio" id="button3" autocomplete="off">
  <label class="btn btn-outline-light" for="button3">Heart-2</label>

  <input type="radio" class="btn-check" name="btnradio" id="button4" autocomplete="off">
  <label class="btn btn-outline-light" for="button4">Broken</label>
</div>

<div id="myEmbeddedScene">
    <a-scene embedded vr-mode-ui="enabled: false">
      <a-asset-item
        id="spine"
        src="innards-spine.glb"
        response-type="arraybuffer"
        crossorigin="anonymous"
      ></a-asset-item>
      <a-entity
        gltf-model="#spine"
        scale="1 1 1"
        rotation="0 -90 0"
        position="-1 0 0"
        wasd-move-component
        drag-rotate-component
        button_enabled="number:1; enabled:'true'"
      ></a-entity>

      <a-asset-item
        id="heart1"
        src="innards-heart1.glb"
        response-type="arraybuffer"
        crossorigin="anonymous"
      ></a-asset-item>
      <a-entity
        gltf-model="#heart1"
        scale="1 1 1"
        rotation="0 -90 0"
        wasd-move-component
        drag-rotate-component
        button_enabled="number:2"
      ></a-entity>

      <a-asset-item
        id="heart2"
        src="innards-heart2.glb"
        response-type="arraybuffer"
        crossorigin="anonymous"
      ></a-asset-item>
      <a-entity
        gltf-model="#heart2"
        scale="1 1 1"
        rotation="0 -90 0"
        wasd-move-component
        drag-rotate-component
        button_enabled="number:3"
      ></a-entity>

      <a-asset-item
        id="broken"
        src="innards-broken.glb"
        response-type="arraybuffer"
        crossorigin="anonymous"
      ></a-asset-item>
      <a-entity
        gltf-model="#broken"
        scale="1 1 1"
        rotation="0 -90 0"
        position="1 0 0"
        wasd-move-component
        drag-rotate-component
        button_enabled="number:4"
      ></a-entity>

      <a-sky color="#600000"></a-sky>
      <a-camera
        id="cam"
        camera="zoom: 4"
        position="0 0 5"
        zoom-component
        wasd-controls-enabled="false"
        look-controls="enabled:false"
      >
      </a-camera>
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity
        light="type: directional; color: #FFCDCD; intensity: 1.5"
        position="0 2 10"
      ></a-entity>
    </a-scene>
    </div>
  </body>
</html>
